// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  * #@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@/((((((( //   @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ((((((((((((((((((( @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ((((* ((      (((((((( ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ///////// @@@@@@@@@@@((((.(( (/(((.    (((((((((( @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ //////////// @@@@@@@@%/ @@    /( @     @ (((((((((((( @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@//////////// @@@@@@@@ // @@   @@ @@      ((*(((((,(((((/ @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@/// ./.  @@@@@@ (((((((((/  @& // @@@@@@&(((((( ((//(//  (((  @@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ //////@@@@@@@@ (((((((((((((((((( /./////////((((//// ((((((((.@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ///// @@@@@@@ ((((((((((((((((((((((( /((((((( (//// ((((((((( @@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@  ///* @@@@@@ ///// @@@@@@# (((((((((((((((  ((((  /(  ((((( ///// (((((((,@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@ ///(((//// @@@@@# ///////// @@ (((((((((((((( ((((((((((((. ((( //// ((((( /((   @@@(((((((( @@@@@@
// @@@@@@@@@@@@@( *@@@*//(((((((/ / @@@@@@@@@@@@@@@@@@@@& (((((((( *((((((((((((((((( (((  // .(( ((((((( @@(((((((( @@@@@@
// @@@@@@@@@ ////(((((( //(((((((/ / @@@@@@@@@@@@@@@@@@@@@@ ((((((((    (((((((((((((((  ((((((( ((((( @@@@(.((, ( @@@@@@@@
// @@@@@@@@ ////(((((((((( /((((((/, @@@@@@@@@@@@@@@@@@@@@@@@ ((((((    (((((((((((/ /////////// (((((((((( (((((((,@@@@@@@
// @@@@@@@@ // /(((((((((((( /(((//..@@@@@@@@@@@@@@@@@@@@@@@@ %%  ((((((((((((  #%% //((((((((((/(((((((((, (((((( @@@@@@@@
// @@@@@@@@@*/*//(((((((((((( /((/// @@@@@@@@@@@@@@@@@@@@@@@ %%&&&%%%%%%%%%%%%%%%%% /((((((((((( ((((((((( ((((((( @@@@@@@@
// @@@@@@@@@@./,//(((((((((((( (/// @@@@@@@@@@@@@@@@@@@@@@@@,%,%&&&&&&&&&&&&&&&&%% //((((((. (((((( (((((((((((( @@@@@@@@@@
// @@@@@@@@@@@ // //(((((((((( // %@@@@@@@@@@@@@@@@@@@@@@@@/  %%%&&&&&&&&&&&&&&&% /((.  ((((((((((( (/        @@@@@@@@@@@@@
// @@@@@@@@@@@@@/ /////(((((( %%% @@@@@@@@@@@@@@@@@@@@@@@ %%&&& %%%&&&&&&&&&&&&& /(((((((((((( ((( @@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@  *///   ( &&&&&% @@@@@@@@@@@@@  %%*.%%&&&&&&&&&&&&&&&&&&& /((((((((( ((((. (.@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@ (( &&&&&&&.%%  ,%  @ %%&&&&.%&&&&&&&&&&&&&&&&&& (//// (((((((((((,((@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@ (((( &&&&&&%%%&&&&& %(&&&&&( &&&&&&&&&&&&&&& /(((((((////((((((((((@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@ ((((( &&&&&&&&&&&& &&&&&&&&&&&&&&&&&&&&& (((((((((((((// ((((((( @@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@ ( /((((  &&&&&&&&&&&&&&&&&&&&&&&&&% ((((((((((((((((((//*(((( @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@ /(((// ((((  ,&&&&&&&&&&&   (((// ((((((((((((((((///  (  @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@  / (((((((((((((//((((((((((((///(((((((( (((((///#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ (((((((((((// (((((((((((((// ((((((((((/// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.  ///// ((((( /((((((((////(((((((/ ,@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#  ((((((//////.     @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
// @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
//
// Satoshi's Shrimp Shanty
//
// 7694 shrimp ready to jump from the shanty to the blockchain
// https://www.shrimp.fun/
//
// Twitter: https://twitter.com/satoshisshrimp
//
// 0.5 ETH lottery for holders every 500 mints
// Special traits can be minted that will unlock airdrops 
// Minting a 1/1 will win you 0.2 ETH
// Surprise IRL use giveaways during mint and after mintout
// 4 Special 1/1s that unlock a blue chip airdrop
// 
// 
// Come join the shanty today!
// 
//
// You never know what you’re gonna get….
//
//
//
// SPDX-License-Identifier: MIT

pragma solidity ^0.8.10;


import "./ERC721ABurnable.sol";
import "./Ownable.sol";
import "./MerkleProof.sol";
import "./IERC20.sol";
import "./IERC2981.sol";
import "./ReentrancyGuard.sol";

contract Shrimp is ERC721ABurnable, Ownable, ReentrancyGuard {

  enum ReleaseMode{ CLOSED, DEV, PRE_SALE, OPEN, ENDED }
  ReleaseMode public currentMode;
  mapping(address => uint256) private _mintedPerAddress;
  mapping(address => uint256) private _freeFishRedeemed;
  bytes32 private _freeFishMerkleRoot;
  uint256 private MAX_PER_ADDRESS = 100;
  uint256 private MAXFREECLAIM = 10;
  uint32 public freeClaimed = 0;
  uint256 public maxSupply;
  uint256 public price = 19940000000000000;
  string private baseTokenURI;
  bool public baseTokenURILocked;
  address private _aeAddress;
  address private _lmdAddress = 0x08b6D64eBB1F252471be381941748EcFa084AF56;


  // Simple Eth check, assuming no freebies.
  modifier requireCorrectEth(uint256 fishCount) {
    require(msg.value == price * fishCount, "Sent incorrect Ether");
    _;
  }

  /// @param fishCount The amount of shrimpies intended to be fished.
  /// @dev All of our validations that we check before a mint.
  modifier validateFishing(uint256 fishCount) {
    require(
        _mintedPerAddress[msg.sender] + fishCount <= MAX_PER_ADDRESS,
        "Exceeds wallet limit"
    );
    require(totalSupply() + fishCount <= maxSupply, "Would exceed max supply");
    _;
 }

 modifier validatePreSaleAction() {
   require(currentMode == ReleaseMode.PRE_SALE || currentMode == ReleaseMode.OPEN, "Not presale time yet");
   _;
 }

 /// @dev Dev time?
 modifier validateDevsAction() {
   require(currentMode == ReleaseMode.DEV, "Not dev time yet");
   _;
 }

 /// @param baseTokenURI_ The starting baseTokenURI
 /// @param maxSupply_ How many items are mintable?
 /// @dev The constructor!
 constructor(
     uint256 maxSupply_,
     string memory baseTokenURI_
     )
     ERC721A("SatoshiShrimps", "SHRIMPS")
 {
     maxSupply = maxSupply_;
     baseTokenURI = baseTokenURI_;
         
 }

 /// @notice Returns whether or not you, the person calling this method, have fished a fish.
 function freeFishClaimed(address a) external view returns (bool){
   return _freeFishRedeemed[a] == 1;
 }

 function setPrice(uint256 newPrice) public onlyOwner {
   price = newPrice;
 }
 function generalFishing(uint fishCount) validateFishing(fishCount) requireCorrectEth(fishCount) nonReentrant external payable {
     require(currentMode == ReleaseMode.OPEN, "It's not go time yet.");
     mint(msg.sender, fishCount, true);
 }

 /// @param _merkleProof The proof generated by the front end


 function whitelistFreeFishing(bytes32[] memory _merkleProof, uint fishCount) validateFishing(fishCount) nonReentrant external payable {
     require(currentMode == ReleaseMode.OPEN, "It's not go time yet.");
     require(freeClaimed < MAXFREECLAIM, "too many shrimpies claimed");
     bytes32 leaf = keccak256(abi.encodePacked(msg.sender));

     // The amount we're charging (e.g, the amount we're validating) will depend on
     // if we detected a free mint match. If so we check for a lesser amount of eth.
     uint fishingFeesToCharge = fishCount;
     if(MerkleProof.verify(_merkleProof, _freeFishMerkleRoot, leaf)){
       if(_freeFishRedeemed[msg.sender] != 1){ // if the fish is NOT already redeemed, mark it as used and let us use the free one.
         fishingFeesToCharge = fishingFeesToCharge - 3;
         _freeFishRedeemed[msg.sender] = 1;
         freeClaimed = freeClaimed + 3;

       }
     }

     require(msg.value == price * fishingFeesToCharge, "Sent incorrect Ether");
     mint(msg.sender, fishCount, true);
 }




 function generalFreeFishing(uint fishCount) validateFishing(fishCount) requireCorrectEth(fishCount) nonReentrant external payable{
     require(currentMode == ReleaseMode.OPEN, "It's not go time yet.");
    
    if(freeClaimed < MAXFREECLAIM){ 
      if(_freeFishRedeemed[msg.sender] != 1){
      // The amount we're charging (e.g, the amount we're validating) will depend on
       // if we detected a free mint match. If so we check for a lesser amount of eth.
         uint fishingFeesToCharge = fishCount;
         fishingFeesToCharge = fishingFeesToCharge;
         _freeFishRedeemed[msg.sender] = 1;
        freeClaimed = freeClaimed + 1;
        fishCount = fishCount + 1;
        require(msg.value == price * fishingFeesToCharge, "Sent incorrect Ether");
        mint(msg.sender, fishCount, true);
      } else{
         require(msg.value == price * fishCount, "Sent incorrect Ether");
         mint(msg.sender, fishCount, true);
     }
      
    } else{
     require(msg.value == price * fishCount, "Sent incorrect Ether");
     mint(msg.sender, fishCount, true);
     }
 }


 function setFreeFishMerkleRoot(bytes32 merkRoot) external onlyOwner {
   _freeFishMerkleRoot = merkRoot;
 }

 function setMaxFish(uint256 newNumber) external onlyOwner {
   MAXFREECLAIM = newNumber;
 }


 /// @dev After we cut over to the permaweb base URI, lock it up so we can't change it back. This is a one-time operation! Don't mess it up!
 function lockBaseTokenURI() external onlyOwner {
   baseTokenURILocked = true;
 }



 /// @param baseTokenURI_ The new baseTokenURI
 /// @dev Need this so we can set the new base URI for the cut over to permaweb.
 function setBaseURI(string memory baseTokenURI_) external onlyOwner {
     require(!baseTokenURILocked, "setBaseURI is locked");
     baseTokenURI = baseTokenURI_;
 }

 // Copy + pasted in the ERC721A in order to override.
 function tokenURI(uint256 tokenId) public view virtual override returns (string memory) {
     require(_exists(tokenId), "ERC721Metadata: URI query for nonexistent token");
     string memory baseURI = baseTokenURI;
     return bytes(baseURI).length > 0 ? string(abi.encodePacked(baseURI, Strings.toString(tokenId), '.json')) : "";
 }

 /// @dev Sets the various wallets for withdrawl.
 function setWalletAddresses(address a) external onlyOwner {
   _aeAddress = a;
 }

 function getWalletAddresses() view external onlyOwner returns(address aeAddress, address lmdAddress){
   return (_aeAddress, _lmdAddress);
 }

 /// @dev Set our current mode to DEV.
 function startDevTeam() external onlyOwner {
   setSaleStatus(ReleaseMode.DEV);
 }


 /// @dev Set our current mode to OPEN, for the general sale.
 function startGeneralSale() external onlyOwner {
   setSaleStatus(ReleaseMode.OPEN);
 }

 /// @dev End the sale (ENDED)
 function endSale() external onlyOwner {
   setSaleStatus(ReleaseMode.ENDED);
 }

 /// @dev Sets the current state to the given status.
 function setSaleStatus(ReleaseMode newStatus) private onlyOwner {
   currentMode = newStatus;
 }

 /// @dev Get paid
 function withdraw() external nonReentrant onlyOwner {
   // Some percentage magic:
   uint256 balance = address(this).balance;
   uint256 tenPercent = balance / 100 * 10;
   payable(_aeAddress).transfer(tenPercent);
   uint256 remaining = address(this).balance;
   payable(_lmdAddress).transfer(remaining);
 }

 /// @param to Who are we minting for?
 /// @param countTowardsWalletLimit Allows us to indicate if this should count towards the "X NFTs per Wallet" limit, or if we bypass that.
 /// @dev Our internal mint method, that handles some universal book-keeping.
 function mint(address to, uint256 count, bool countTowardsWalletLimit) private {
     if(countTowardsWalletLimit){
       _mintedPerAddress[to] += count;
     }
     _safeMint(to, count);
 }

}